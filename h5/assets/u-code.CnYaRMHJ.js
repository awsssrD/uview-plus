import{l as e,n as t,m as s,f as i,o as n,c as a,i as h}from"./index-BAqlIHr8.js";import{_ as r}from"./_plugin-vue_export-helper.BCo6x5W8.js";const c=r({name:"u-code",mixins:[s,i,e({props:{seconds:{type:[String,Number],default:()=>t.code.seconds},startText:{type:String,default:()=>t.code.startText},changeText:{type:String,default:()=>t.code.changeText},endText:{type:String,default:()=>t.code.endText},keepRunning:{type:Boolean,default:()=>t.code.keepRunning},uniqueKey:{type:String,default:()=>t.code.uniqueKey}}})],data(){return{secNum:this.seconds,timer:null,canGetCode:!0}},mounted(){this.checkKeepRunning()},watch:{seconds:{immediate:!0,handler(e){this.secNum=e}}},emits:["start","end","change"],methods:{checkKeepRunning(){let e=Number(uni.getStorageSync(this.uniqueKey+"_$uCountDownTimestamp"));if(!e)return this.changeEvent(this.startText);let t=Math.floor(+new Date/1e3);this.keepRunning&&e&&e>t?(this.secNum=e-t,uni.removeStorageSync(this.uniqueKey+"_$uCountDownTimestamp"),this.start()):this.changeEvent(this.startText)},start(){this.timer&&(clearInterval(this.timer),this.timer=null),this.$emit("start"),this.canGetCode=!1,this.changeEvent(this.changeText.replace(/x|X/,this.secNum)),this.timer=setInterval((()=>{--this.secNum?this.changeEvent(this.changeText.replace(/x|X/,this.secNum)):(clearInterval(this.timer),this.timer=null,this.changeEvent(this.endText),this.secNum=this.seconds,this.$emit("end"),this.canGetCode=!0)}),1e3),this.setTimeToStorage()},reset(){this.canGetCode=!0,clearInterval(this.timer),this.secNum=this.seconds,this.changeEvent(this.endText)},changeEvent(e){this.$emit("change",e)},setTimeToStorage(){if(this.keepRunning&&this.timer&&this.secNum>0&&this.secNum<this.seconds){let e=Math.floor(+new Date/1e3);uni.setStorage({key:this.uniqueKey+"_$uCountDownTimestamp",data:e+Number(this.secNum)})}}},beforeUnmount(){this.setTimeToStorage(),clearTimeout(this.timer),this.timer=null}},[["render",function(e,t,s,i,r,c){const u=h;return n(),a(u,{class:"u-code"})}],["__scopeId","data-v-0a8d12b4"]]);export{c as _};
