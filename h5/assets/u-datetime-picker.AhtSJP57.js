import{_ as e}from"./u-input.UeLZNhZF.js";import{l as t,n as i,m as a,f as n,ac as r,N as o,W as s,D as l,r as u,o as m,c as h,w as c,a as d,v as p,h as f,i as y}from"./index-k6E_5O2r.js";import{r as g}from"./uni-app.es.Ds05vgWQ.js";import{_ as x}from"./u-picker.DmlA3iZm.js";import{d as k}from"./index.t89P32GB.js";import{_ as C}from"./_plugin-vue_export-helper.BCo6x5W8.js";const I=C({name:"datetime-picker",mixins:[a,n,t({props:{hasInput:{type:Boolean,default:()=>!1},placeholder:{type:String,default:()=>"请选择"},format:{type:String,default:()=>""},show:{type:Boolean,default:()=>i.datetimePicker.show},popupMode:{type:String,default:()=>i.picker.popupMode},showToolbar:{type:Boolean,default:()=>i.datetimePicker.showToolbar},modelValue:{type:[String,Number],default:()=>i.datetimePicker.value},title:{type:String,default:()=>i.datetimePicker.title},mode:{type:String,default:()=>i.datetimePicker.mode},maxDate:{type:Number,default:()=>i.datetimePicker.maxDate},minDate:{type:Number,default:()=>i.datetimePicker.minDate},minHour:{type:Number,default:()=>i.datetimePicker.minHour},maxHour:{type:Number,default:()=>i.datetimePicker.maxHour},minMinute:{type:Number,default:()=>i.datetimePicker.minMinute},maxMinute:{type:Number,default:()=>i.datetimePicker.maxMinute},filter:{type:[Function,null],default:()=>i.datetimePicker.filter},formatter:{type:[Function,null],default:()=>i.datetimePicker.formatter},loading:{type:Boolean,default:()=>i.datetimePicker.loading},itemHeight:{type:[String,Number],default:()=>i.datetimePicker.itemHeight},cancelText:{type:String,default:()=>i.datetimePicker.cancelText},confirmText:{type:String,default:()=>i.datetimePicker.confirmText},cancelColor:{type:String,default:()=>i.datetimePicker.cancelColor},confirmColor:{type:String,default:()=>i.datetimePicker.confirmColor},visibleItemCount:{type:[String,Number],default:()=>i.datetimePicker.visibleItemCount},closeOnClickOverlay:{type:Boolean,default:()=>i.datetimePicker.closeOnClickOverlay},defaultIndex:{type:Array,default:()=>i.datetimePicker.defaultIndex}}})],data:()=>({inputValue:"",showByClickInput:!1,columns:[],innerDefaultIndex:[],innerFormatter:(e,t)=>t}),watch:{show(e,t){e&&this.updateColumnValue(this.innerValue)},modelValue(e){this.init()},propsChange(){this.init()}},computed:{propsChange(){return[this.mode,this.maxDate,this.minDate,this.minHour,this.maxHour,this.minMinute,this.maxMinute,this.filter]}},mounted(){this.init()},emits:["close","cancel","confirm","change","update:modelValue"],methods:{getInputValue(e){if(""!=e&&e&&null!=e)if("time"==this.mode)this.inputValue=e;else if(this.format)this.inputValue=k(e).format(this.format);else{let t="";switch(this.mode){case"date":t="YYYY-MM-DD";break;case"year-month":t="YYYY-MM";break;case"datetime":t="YYYY-MM-DD HH:mm";break;case"time":t="HH:mm"}this.inputValue=k(e).format(t)}else this.inputValue=""},init(){this.innerValue=this.correctValue(this.modelValue),this.updateColumnValue(this.innerValue),this.getInputValue(this.innerValue)},setFormatter(e){this.innerFormatter=e},close(){this.closeOnClickOverlay&&this.$emit("close")},cancel(){this.hasInput&&(this.showByClickInput=!1),this.$emit("cancel")},confirm(){this.$emit("update:modelValue",this.innerValue),this.hasInput&&(this.getInputValue(this.innerValue),this.showByClickInput=!1),this.$emit("confirm",{value:this.innerValue,mode:this.mode})},intercept(e,t){let i=e.match(/\d+/g);return i.length>1?0:t&&4==i[0].length?i[0]:i[0].length>2?0:i[0]},change(e){const{indexs:t,values:i}=e;let a="";if("time"===this.mode)a=`${this.intercept(i[0][t[0]])}:${this.intercept(i[1][t[1]])}`;else{const e=parseInt(this.intercept(i[0][t[0]],"year")),n=parseInt(this.intercept(i[1][t[1]]));let r=parseInt(i[2]?this.intercept(i[2][t[2]]):1),o=0,s=0;const l=k(`${e}-${n}`).daysInMonth();"year-month"===this.mode&&(r=1),r=Math.min(l,r),"datetime"===this.mode&&(o=parseInt(this.intercept(i[3][t[3]])),s=parseInt(this.intercept(i[4][t[4]]))),a=Number(new Date(e,n-1,r,o,s))}a=this.correctValue(a),this.innerValue=a,this.updateColumnValue(a),this.$emit("change",{value:a,mode:this.mode})},updateColumnValue(e){this.innerValue=e,this.updateColumns(),setTimeout((()=>{this.updateIndexs(e)}),0)},updateIndexs(e){let t=[];const i=this.formatter||this.innerFormatter;if("time"===this.mode){const a=e.split(":");t=[i("hour",a[0]),i("minute",a[1])]}else t=[i("year",`${k(e).year()}`),i("month",r(k(e).month()+1))],"date"===this.mode&&t.push(i("day",r(k(e).date()))),"datetime"===this.mode&&t.push(i("day",r(k(e).date())),i("hour",r(k(e).hour())),i("minute",r(k(e).minute())));const a=this.columns.map(((e,i)=>Math.max(0,e.findIndex((e=>e===t[i])))));this.innerDefaultIndex=a},updateColumns(){const e=this.formatter||this.innerFormatter,t=this.getOriginColumns().map((t=>t.values.map((i=>e(t.type,i)))));this.columns=t},getOriginColumns(){return this.getRanges().map((({type:e,range:t})=>{let i=function(e,t){let i=-1;const a=Array(e<0?0:e);for(;++i<e;)a[i]=t(i);return a}(t[1]-t[0]+1,(i=>{let a=t[0]+i;return a="year"===e?`${a}`:r(a),a}));return this.filter&&(i=this.filter(e,i),(!i||i&&0==i.length)&&uni.showToast({title:"日期filter结果不能为空",icon:"error",mask:!0})),{type:e,values:i}}))},generateArray:(e,t)=>Array.from(new Array(t+1).keys()).slice(e),correctValue(e){const t="time"!==this.mode;if(t&&!o.date(e)?e=this.minDate:t||e||(e=`${r(this.minHour)}:${r(this.minMinute)}`),t)return e=k(e).isBefore(k(this.minDate))?this.minDate:e,e=k(e).isAfter(k(this.maxDate))?this.maxDate:e;{if(-1===String(e).indexOf(":"))return s();let[t,i]=e.split(":");return t=r(l(this.minHour,this.maxHour,Number(t))),i=r(l(this.minMinute,this.maxMinute,Number(i))),`${t}:${i}`}},getRanges(){if("time"===this.mode)return[{type:"hour",range:[this.minHour,this.maxHour]},{type:"minute",range:[this.minMinute,this.maxMinute]}];const{maxYear:e,maxDate:t,maxMonth:i,maxHour:a,maxMinute:n}=this.getBoundary("max",this.innerValue),{minYear:r,minDate:o,minMonth:s,minHour:l,minMinute:u}=this.getBoundary("min",this.innerValue),m=[{type:"year",range:[r,e]},{type:"month",range:[s,i]},{type:"day",range:[o,t]},{type:"hour",range:[l,a]},{type:"minute",range:[u,n]}];return"date"===this.mode&&m.splice(3,2),"year-month"===this.mode&&m.splice(2,3),m},getBoundary(e,t){const i=new Date(t),a=new Date(this[`${e}Date`]),n=k(a).year();let r=1,o=1,s=0,l=0;return"max"===e&&(r=12,o=k(i).daysInMonth(),s=23,l=59),k(i).year()===n&&(r=k(a).month()+1,k(i).month()+1===r&&(o=k(a).date(),k(i).date()===o&&(s=k(a).hour(),k(i).hour()===s&&(l=k(a).minute())))),{[`${e}Year`]:n,[`${e}Month`]:r,[`${e}Date`]:o,[`${e}Hour`]:s,[`${e}Minute`]:l}}}},[["render",function(t,i,a,n,r,o){const s=g(u("up-input"),e),l=y,k=g(u("u-picker"),x);return m(),h(l,{class:"u-datetime-picker"},{default:c((()=>[t.hasInput?(m(),h(l,{key:0,class:"u-datetime-picker__has-input",onClick:i[1]||(i[1]=e=>r.showByClickInput=!r.showByClickInput)},{default:c((()=>[d(s,{placeholder:t.placeholder,readonly:!!r.showByClickInput,border:"surround",modelValue:r.inputValue,"onUpdate:modelValue":i[0]||(i[0]=e=>r.inputValue=e)},null,8,["placeholder","readonly","modelValue"])])),_:1})):p("",!0),d(k,{ref:"picker",show:t.show||t.hasInput&&r.showByClickInput,popupMode:t.popupMode,closeOnClickOverlay:t.closeOnClickOverlay,columns:r.columns,title:t.title,itemHeight:t.itemHeight,showToolbar:t.showToolbar,visibleItemCount:t.visibleItemCount,defaultIndex:r.innerDefaultIndex,cancelText:t.cancelText,confirmText:t.confirmText,cancelColor:t.cancelColor,confirmColor:t.confirmColor,toolbarRightSlot:t.toolbarRightSlot,onClose:o.close,onCancel:o.cancel,onConfirm:o.confirm,onChange:o.change},{"toolbar-right":c((()=>[f(t.$slots,"toolbar-right",{},void 0,!0)])),"toolbar-bottom":c((()=>[f(t.$slots,"toolbar-bottom",{},void 0,!0)])),_:3},8,["show","popupMode","closeOnClickOverlay","columns","title","itemHeight","showToolbar","visibleItemCount","defaultIndex","cancelText","confirmText","cancelColor","confirmColor","toolbarRightSlot","onClose","onCancel","onConfirm","onChange"])])),_:3})}],["__scopeId","data-v-374b41f2"]]);export{I as _};
