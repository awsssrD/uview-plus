import{h as t,j as e,m as i,k as s,l as n,$ as o,V as h,o as r,c as a,w as l,a as d,f as c,t as u,q as p,g as x,i as g,x as f,u as m,y as _,I,v,r as y,s as L,b as w,d as H,F as T,D as b,H as S}from"./index-C3UXxwfW.js";import{_ as $}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{_ as C}from"./up-transition.CkVV8kmf.js";import{r as R}from"./uni-app.es.CqYlZVXb.js";const V=$({name:"up-index-anchor",mixins:[i,s,t({props:{text:{type:[String,Number],default:()=>e.indexAnchor.text},color:{type:String,default:()=>e.indexAnchor.color},size:{type:[String,Number],default:()=>e.indexAnchor.size},bgColor:{type:String,default:()=>e.indexAnchor.bgColor},height:{type:[String,Number],default:()=>e.indexAnchor.height}}})],data:()=>({}),mounted(){this.init()},methods:{addUnit:n,init(){const t=o.call(this,"up-index-list");if(!t)return h();t.anchors.push(this);const e=o.call(this,"up-index-item");if(!e)return h();e.id=this.text.charCodeAt(0)}}},[["render",function(t,e,i,s,n,o){const h=x,f=g;return r(),a(f,{class:"up-index-anchor up-border-bottom",ref:`up-index-anchor-${t.text}`,style:p({height:o.addUnit(t.height),backgroundColor:t.bgColor})},{default:l((()=>[d(h,{class:"up-index-anchor__text",style:p({fontSize:o.addUnit(t.size),color:t.color})},{default:l((()=>[c(u(t.text),1)])),_:1},8,["style"])])),_:1},8,["style"])}],["__scopeId","data-v-91f636f1"]]);const k=$({name:"up-index-item",mixins:[i,s,t({props:{}})],data:()=>({top:0,height:0,id:""}),created(){this.anchor={}},mounted(){this.init()},methods:{init(){if(this.getParentData("up-index-list"),!this.parent)return h();f().then((()=>{this.getIndexItemRect().then((t=>{this.top=Math.ceil(t.top),this.height=Math.ceil(t.height)}))}))},getIndexItemRect(){return new Promise((t=>{this.$uGetRect(".up-index-item").then((e=>{t(e)}))}))}}},[["render",function(t,e,i,s,n,o){const h=g;return r(),a(h,{class:_(["up-index-item",[`up-index-item-${n.id}`]]),id:`up-index-item-${n.id}`},{default:l((()=>[m(t.$slots,"default",{},void 0,!0)])),_:3},8,["id","class"])}],["__scopeId","data-v-2ff3e180"]]),A=t({props:{inactiveColor:{type:String,default:()=>e.indexList.inactiveColor},activeColor:{type:String,default:()=>e.indexList.activeColor},indexList:{type:Array,default:()=>e.indexList.indexList},sticky:{type:Boolean,default:()=>e.indexList.sticky},customNavHeight:{type:[String,Number],default:()=>e.indexList.customNavHeight},safeBottomFix:{type:Boolean,default:()=>e.indexList.safeBottomFix}}});const N=$({name:"up-index-list",mixins:[i,s,A],data:()=>({activeIndex:-1,touchmoveIndex:1,letterInfo:{height:0,itemHeight:0,top:0},indicatorHeight:50,touching:!1,scrollTop:0,scrollViewHeight:0,sys:I(),scrolling:!1,scrollIntoView:"",pageY:0,topOffset:0}),computed:{uIndexList(){return this.indexList.length?this.indexList:(()=>{const t=[],e="A".charCodeAt(0);for(let i=0;i<26;i++)t.push(String.fromCharCode(e+i));return t})()},indicatorTop(){const{top:t,height:e,itemHeight:i}=this.letterInfo;return Math.floor(t-e/2+i*this.activeIndex+i-35)}},watch:{uIndexList:{immediate:!1,handler(){f(30).then((()=>{this.setIndexListLetterInfo()}))}}},created(){this.children=[],this.anchors=[]},mounted(){this.init(),f(50).then((()=>{this.setIndexListLetterInfo()}))},methods:{addUnit:n,init(){let t=v(this.customNavHeight);this.getIndexListRect().then((async e=>{this.scrollViewHeight=e.height?e.height:this.sys.windowHeight-t,this.topOffset=this.sys.windowHeight-this.scrollViewHeight}))},touchStart(t){const e=t.changedTouches[0];if(!e)return;this.touching=!0;const{pageY:i,screenY:s}=e,n=this.getIndexListLetter(i);this.setValueForTouch(n)},touchMove(t){let e=t.changedTouches[0];if(!e)return;this.touching||(this.touching=!0);const{pageY:i,screenY:s}=e,n=this.getIndexListLetter(i);this.setValueForTouch(n)},touchEnd(t){f(300).then((()=>{this.touching=!1}))},getIndexListLetterRect(){return new Promise((t=>{this.$uGetRect(".up-index-list__letter").then((e=>{t(e)}))}))},getIndexListScrollViewRect(){return new Promise((t=>{this.$uGetRect(".up-index-list__scroll-view").then((e=>{t(e)}))}))},getIndexListRect(){return new Promise((t=>{this.$uGetRect(".up-index-list").then((e=>{t(e)}))}))},setIndexListLetterInfo(){this.getIndexListLetterRect().then((t=>{const{height:e}=t,i=I();i.windowHeight,0==this.customNavHeight?i.windowTop:v(this.customNavHeight),this.getIndexListScrollViewRect().then((t=>{this.letterInfo={height:e,top:t.height/2,itemHeight:Math.floor(e/this.uIndexList.length)}}))}))},getIndexListLetter(t){this.pageY=t;let{top:e,height:i,itemHeight:s}=this.letterInfo,n=this.currentIndex;return e-=i/2,n=(t-=this.topOffset)<e?0:t>=e+i?this.uIndexList.length-1:Math.floor((t-e)/s),n},async setValueForTouch(t){t!==this.activeIndex&&(this.activeIndex=t,this.scrollIntoView=`up-index-item-${this.uIndexList[t].charCodeAt(0)}`)},getHeaderRect(){return new Promise((t=>{this.$slots.header||t({width:0,height:0}),this.$uGetRect(".up-index-list__header").then((e=>{t(e)}))}))},async scrollHandler(t){if(this.touching||this.scrolling)return;this.scrolling=!0,f(10).then((()=>{this.scrolling=!1}));let e=0;const i=this.children.length;let s=this.children;let n=(await this.getHeaderRect()).height;this.anchors,s=this.children.map(((t,e)=>{const i={height:t.height,top:n};return n+=t.height,i})),e=t.detail.scrollTop,e+=v(this.customNavHeight);for(let o=0;o<i;o++){const t=s[o],n=s[o+1];if(e<=s[0].top||e>=s[i-1].top+s[i-1].height){this.activeIndex=-1;break}if(!n){this.activeIndex=i-1;break}if(e>t.top&&e<n.top){this.activeIndex=o;break}}}}},[["render",function(t,e,i,s,n,o){const h=g,f=S,I=x,v=R(y("up-transition"),C);return r(),a(h,{ref:"up-index-list",class:"up-index-list"},{default:l((()=>[d(f,{scrollTop:n.scrollTop,scrollIntoView:n.scrollIntoView,"offset-accuracy":1,style:p({maxHeight:o.addUnit(n.scrollViewHeight)}),"scroll-y":"",onScroll:o.scrollHandler,ref:"up-index-list__scroll-view",class:"up-index-list__scroll-view"},{default:l((()=>[t.$slots.header?(r(),a(h,{key:0,class:"up-index-list__header"},{default:l((()=>[m(t.$slots,"header",{},void 0,!0)])),_:3})):L("",!0),m(t.$slots,"default",{},void 0,!0),t.$slots.footer?(r(),a(h,{key:1,class:"up-index-list__footer"},{default:l((()=>[m(t.$slots,"footer",{},void 0,!0)])),_:3})):L("",!0)])),_:3},8,["scrollTop","scrollIntoView","style","onScroll"]),d(h,{class:"up-index-list__letter",ref:"up-index-list__letter",style:p({top:o.addUnit(n.letterInfo.top),transform:"translateY(-50%)"}),onTouchstart:b(o.touchStart,["prevent"]),onTouchmove:b(o.touchMove,["prevent"]),onTouchend:b(o.touchEnd,["prevent"]),onTouchcancel:b(o.touchEnd,["prevent"])},{default:l((()=>[(r(!0),w(T,null,H(o.uIndexList,((e,i)=>(r(),a(h,{class:"up-index-list__letter__item",key:i,style:p({backgroundColor:n.activeIndex===i?t.activeColor:"transparent"})},{default:l((()=>[d(I,{class:"up-index-list__letter__item__index",style:p({color:n.activeIndex===i?"#fff":t.inactiveColor})},{default:l((()=>[c(u(e),1)])),_:2},1032,["style"])])),_:2},1032,["style"])))),128))])),_:1},8,["style","onTouchstart","onTouchmove","onTouchend","onTouchcancel"]),d(v,{mode:"fade",show:n.touching,customStyle:{position:"absolute",right:"50px",top:o.addUnit(o.indicatorTop,"px"),zIndex:3}},{default:l((()=>[d(h,{class:_(["up-index-list__indicator",["up-index-list__indicator--show"]]),style:p({height:o.addUnit(n.indicatorHeight),width:o.addUnit(n.indicatorHeight)})},{default:l((()=>[d(I,{class:"up-index-list__indicator__text"},{default:l((()=>[c(u(o.uIndexList[n.activeIndex]),1)])),_:1})])),_:1},8,["style"])])),_:1},8,["show","customStyle"])])),_:3},512)}],["__scopeId","data-v-6bc1adad"]]);export{V as _,k as a,N as b};
